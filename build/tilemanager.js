(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["spriteentity"],function(e){var n,r,i;return n=function(e){function n(e){n.__super__.constructor.call(this,e),this.row=e.row,this.col=e.col,this.layers=[null,null,null,null,null]}return t(n,e),n.prototype.addTileLayer=function(e,t){var n,r;t=t||e.layer,r=this.layers[t]!=null;if(r&&this.layers[t].name===e.name){Hal.log.debug("You're trying to add the same layer");return}return r&&this.layers[t].destroy(),this.layers[t]=e,n=this.addEntityToQuadspace(e),n.attr("shape",this.shape),n.attr("draw_shape",!1),n},n.prototype.init=function(){return n.__super__.init.call(this),this.on("LAYER_DESTROYED",function(e){return Hal.log.debug("layer destroyed "+e),this.layers[e]=null})},n.prototype.destroy=function(e){return e==null&&(e=!1),this.parent.trigger("ENTITY_DESTROYED",this),n.__super__.destroy.call(this,e)},n}(e),r=function(e){function n(e){n.__super__.constructor.call(this,e),this.name=e.name!=null?e.name:""+this.id,this.layer=e.layer!=null?e.layer:0,this.on("SELECTED",function(){return this.attr("glow",!0),this.attr("glow_color","blue"),this.attr("draw_shape",!0),this.attr("stroke_color","white"),Hal.tween(this,"line_width",200,1,14.5,5)}),this.on("DESELECTED",function(){return this.attr("line_width",1),this.attr("glow",!1),this.attr("draw_shape",!1)})}return t(n,e),n.prototype.destroy=function(e){return e==null&&(e=!0),Hal.log.debug("destroying myself"),Hal.log.debug(this),this.parent!=null&&this.parent.trigger("LAYER_DESTROYED",this.layer),n.__super__.destroy.call(this,e)},n}(e),i=function(){function e(e,t){var n=this;this.map=e,t==null&&(t=""),this.tile_layer_map={},this.tile_name_map={},this._id=0,Hal.on("TILE_MNGR_NEW_TILE",function(e){return n.add(e)}),Hal.on("TILE_MNGR_LOAD_TILES",function(e){return n.load(e)})}return e.prototype.loadFromList=function(e){var t,n,r,i,s=this;e==null&&(e="assets/TilesList.list"),Ajax.get("assets/amjad/TilesList.json",function(e){}),Hal.log.debug("TileManager loaded tiles."),r=JSON.parse(r),i=[];for(t in r)n=r[t],i.push(this.add(n));return i},e.prototype.load=function(e){var t,n,r;Hal.log.debug("Loading tiles..."),Hal.log.debug(e),r=[];for(t in e)n=e[t],r.push(this.add(n));return r},e.prototype.add=function(e){return e.id=++this._id,this.tile_name_map[e.name]=e,this.tile_layer_map[e.layer]==null&&(this.tile_layer_map[e.layer]={}),this.tile_layer_map[e.layer][e.name]=e},e.prototype.removeByName=function(e){var t;return t=this.tile_name_map[e],delete this.tile_layer_map[t.layer][t.name],delete this.tile_name_map[t.name],t=null},e.prototype.newTileLayer=function(e){return new r(e)},e.prototype.newTileHolder=function(e){return e.parent=this.map,new n(e)},e.prototype.addTileLayerToHolder=function(e,t,n,r,i){n==null&&(n=t.layer),r==null&&(r=0),i==null&&(i=0);if(e==null||t==null){Hal.log.debug("holder or tile is null");return}t.attr("group")==="default"&&t.attr("group","layer_"+n),Hal.log.debug("x_offset: "+r),Hal.log.debug("y_offset: "+i),t=e.addTileLayer(t,n);if(t==null)return;return Hal.log.debug(r),Hal.log.debug(i),t.attr("w",r),t.attr("h",i),t},e}()})}).call(this);