(function(){define([],function(){var e;return e=function(){function e(e){var t=this;this.renderspace=document.getElementById("renderspace"),this.hud=document.getElementById("hud"),this.viewport=document.getElementById("viewport"),this.area=renderspace.getBoundingClientRect(),this.current_zindex=1e3,this.canvases=[],this.in_fullscreen=!1,this.screen_w=window.screen.availWidth,this.screen_h=window.screen.availHeight,this.fullscreen_scale=[1,1],e.on("SUPPORTS_FULLSCREEN",function(){return document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.requestFullScreen}),e.on("FULLSCREEN_CHANGE",function(n){var r,i,s,o;if(n){e.r.resize(t.screen_w/t.fullscreen_scale[0],t.screen_h/t.fullscreen_scale[1]),s=t.canvases;for(i in s)r=s[i],r.setAttribute("style",(r.getAttribute("style")||"")+" "+"-webkit-transform: scale3d("+t.fullscreen_scale[0]+","+t.fullscreen_scale[1]+", 1.0); -webkit-transform-origin: 0 0 0;");return t.area=t.renderspace.getBoundingClientRect(),e.scm.enterFullScreen(t.fullscreen_scale)}t.renderspace.style.width=e.r.prev_bounds[2]+"px",t.renderspace.style.height=e.r.prev_bounds[3]+"px",e.r.resize(e.r.prev_bounds[2],e.r.prev_bounds[3]),o=t.canvases;for(i in o)r=o[i],r.setAttribute("style",(r.getAttribute("style")||"")+" "+"-webkit-transform: scale3d(1.0, 1.0, 1.0); -webkit-transform-origin: 0 0 0;");return t.area=t.renderspace.getBoundingClientRect(),e.scm.exitFullScreen([1,1])}),e.on("DOM_ADD",function(e){if(e!=null)return e.call(null,t.hud)}),window.addEventListener("resize",function(){return t.area=t.renderspace.getBoundingClientRect(),t.screen_w=window.screen.availHeight,t.screen_h=window.screen.availHeight,e.trigger("RESIZE",t.area)}),document.addEventListener("fullscreenchange",function(){return this.in_fullscreen=!this.in_fullscreen,e.trigger("FULLSCREEN_CHANGE",this.in_fullscreen)},!1),document.addEventListener("webkitfullscreenchange",function(){return this.in_fullscreen=!this.in_fullscreen,e.trigger("FULLSCREEN_CHANGE",this.in_fullscreen)},!1),document.addEventListener("mozfullscreenchange",function(){return this.in_fullscreen=!this.in_fullscreen,e.trigger("FULLSCREEN_CHANGE",this.in_fullscreen)},!1),e.on("REQUEST_FULLSCREEN",function(n){if(!e.supports("FULLSCREEN")){log.warn("Fullscreen not supported");return}if(!t.in_fullscreen)return t.renderspace.style.width=t.screen_w+"px",t.renderspace.style.height=t.screen_h+"px",t.renderspace.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)})}return e}(),e.prototype.createCanvas=function(e,t){var n;return e==null&&(e=this.area.width),t==null&&(t=this.area.height),n=document.createElement("canvas"),n.width=e,n.height=t,n},e.prototype.createCanvasLayer=function(e,t,n){var r,i;return e==null&&(e=this.area.width),t==null&&(t=this.area.height),i=this.current_zindex+n,this.canvases[i]?this.canvases[i]:(r=this.createCanvas(e,t),r.style["z-index"]=i,r)},e.prototype.addCanvas=function(e,t,n,r){var i;t==null&&(t=0),n==null&&(n=0),i=e.style["z-index"];if(this.canvases[i])return;return e.style.left=t+"px",e.style.top=n+"px",r||(e.style["background-color"]="white"),this.viewport.appendChild(e),this.canvases[i]=e},e})}).call(this);